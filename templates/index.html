<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Memories Maker â€“ Print-Ready Photo Converter</title>
  <meta name="description"
    content="Turn your photos into beautifully framed, print-ready layouts with cut marks. Upload, process, and download in seconds." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@500;600&family=DM+Sans:wght@400;500&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='6' fill='%23c07878'/><rect x='6' y='5' width='20' height='22' rx='2' fill='white'/><rect x='6' y='5' width='20' height='15' rx='2' fill='%23f0d8d8'/></svg>" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>

<body>

  <!-- â”€â”€ White header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header class="header">
    <div class="header-inner">
      <h1>memories <span class="accent">maker</span></h1>
      <p class="tagline">turn your photos into beautifully framed, print-ready layouts â€” ready to cut &amp; display.</p>
      <button class="guide-btn" id="guide-btn" aria-expanded="false" aria-controls="guide-panel">
        how it works
        <svg class="guide-btn__arrow" width="11" height="11" viewBox="0 0 14 14" fill="none" stroke="currentColor"
          stroke-width="2.2" stroke-linecap="round">
          <polyline points="2 5 7 10 12 5" />
        </svg>
      </button>
    </div>
  </header>

  <!-- â”€â”€ Collapsible guide panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="guide-panel" id="guide-panel" aria-hidden="true">
    <div class="guide-panel__inner">
      <ol class="guide-steps">
        <li class="guide-step">
          <span class="guide-step__num" style="--c: var(--accent-rose)">1</span>
          <div><strong>upload</strong> â€” drop or browse photos in any size or orientation. exif rotation is corrected
            automatically.</div>
        </li>
        <li class="guide-step">
          <span class="guide-step__num" style="--c: var(--accent-amber)">2</span>
          <div><strong>choose output</strong> â€” individual prints, an a4 print sheet (img or pdf), or both.
          </div>
        </li>
        <li class="guide-step">
          <span class="guide-step__num" style="--c: var(--accent-sage)">3</span>
          <div><strong>process</strong> â€” each image is center-cropped to a square with 10% white border on sides &amp;
            top, 25% chin at the bottom.</div>
        </li>
        <li class="guide-step">
          <span class="guide-step__num" style="--c: var(--accent-lavender)">4</span>
          <div><strong>print &amp; cut</strong> â€” grey cross marks at each corner guide your scissors for a perfect
            trim.</div>
        </li>
      </ol>
    </div>
  </div>

  <!-- â”€â”€ Main / rainbow stripe area â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <main class="page-wrap">
    <section class="card upload-card">

      <!-- Drop zone -->
      <div id="drop-zone" class="drop-zone" role="button" aria-label="Upload photos" tabindex="0">
        <div class="drop-zone__inner">
          <div class="drop-zone__icon">
            <svg width="52" height="52" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2"
              stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
          </div>
          <p class="drop-zone__label">drag &amp; drop photos here</p>
          <p class="drop-zone__sub">or</p>
          <label class="btn btn--secondary" for="file-input">browse files</label>
          <input type="file" id="file-input" name="images" accept="image/*" multiple />
          <div id="file-badge" class="file-badge hidden">
            <span id="file-count"></span> photo(s) selected
          </div>
          <p class="drop-zone__formats">jpg &nbsp;Â·&nbsp; png &nbsp;Â·&nbsp; webp &nbsp;Â·&nbsp; bmp &nbsp;Â·&nbsp; tiff
          </p>
        </div>
      </div>

      <!-- File list -->
      <ul id="file-list" class="file-list" aria-label="Selected files"></ul>

      <!-- Output type selector â€” centred -->
      <div class="output-toggle" role="group" aria-label="Output type">
        <span class="output-toggle__label">output</span>
        <div class="output-toggle__options">
          <label class="toggle-opt">
            <input type="radio" name="layout" value="individual" checked />
            <span>individual prints</span>
          </label>
          <label class="toggle-opt">
            <input type="radio" name="layout" value="a4" />
            <span>a4 sheet (img)</span>
          </label>
          <label class="toggle-opt">
            <input type="radio" name="layout" value="a4_pdf" />
            <span>a4 sheet (pdf)</span>
          </label>
          <label class="toggle-opt">
            <input type="radio" name="layout" value="both" />
            <span>both (img)</span>
          </label>
          <label class="toggle-opt">
            <input type="radio" name="layout" value="both_pdf" />
            <span>both (pdf)</span>
          </label>
        </div>
      </div>

      <!-- Process button -->
      <button id="process-btn" class="btn btn--primary btn--full" disabled>
        <span id="btn-text">select photos to begin</span>
        <div id="btn-spinner" class="spinner hidden" aria-hidden="true"></div>
      </button>

      <div id="error-msg" class="alert alert--error hidden" role="alert"></div>
    </section>

    <!-- Result card -->
    <section id="result-section" class="card result-card hidden" aria-live="polite">
      <div id="progress-state" class="state hidden">
        <div class="big-spinner"></div>
        <p class="state-label">processing your photos&hellip;</p>
        <p class="sub">this may take a moment depending on photo size.</p>
      </div>
      <div id="success-state" class="state hidden">
        <div class="success-icon">âœ¦</div>
        <h2>your memories are ready</h2>
        <p class="sub">all photos processed with frames &amp; cut marks.</p>
        <a id="download-link" href="#" class="btn btn--primary btn--download" download="memories_to_print.zip">
          download as zip
        </a>
        <div id="separate-files-wrap" class="hidden" style="width: 100%; margin-top: 10px;">
          <p class="sub" style="margin-bottom: 12px; font-size: 0.9rem;">or download separately:</p>
          <div id="separate-files-list" style="display: flex; flex-direction: column; gap: 8px;"></div>
        </div>
        <button id="reset-btn" class="btn btn--ghost">process more photos</button>
      </div>
    </section>
  </main>

  <!-- â”€â”€ White footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <footer class="footer">
    <p class="footer-copy">&copy; 2026 memories maker</p>
    <nav class="footer-links" aria-label="Creator links">
      <a href="https://carolinamattiello.vercel.app/" target="_blank" rel="noopener">portfolio</a>
      <span class="footer-sep">&middot;</span>
      <a href="https://www.linkedin.com/in/carolinamattiello/" target="_blank" rel="noopener">linkedin</a>
    </nav>
  </footer>

  <script>
    // â”€â”€ Guide panel toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const guideBtn = document.getElementById('guide-btn');
    const guidePanel = document.getElementById('guide-panel');
    guideBtn.addEventListener('click', () => {
      const open = guideBtn.getAttribute('aria-expanded') === 'true';
      guideBtn.setAttribute('aria-expanded', String(!open));
      guidePanel.setAttribute('aria-hidden', String(open));
      guidePanel.classList.toggle('guide-panel--open', !open);
    });

    // â”€â”€ File handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const processBtn = document.getElementById('process-btn');
    const btnText = document.getElementById('btn-text');
    const btnSpinner = document.getElementById('btn-spinner');
    const fileBadge = document.getElementById('file-badge');
    const fileCount = document.getElementById('file-count');
    const fileListEl = document.getElementById('file-list');
    const errorMsg = document.getElementById('error-msg');
    const resultSection = document.getElementById('result-section');
    const progressState = document.getElementById('progress-state');
    const successState = document.getElementById('success-state');
    const downloadLink = document.getElementById('download-link');
    const resetBtn = document.getElementById('reset-btn');

    let selectedFiles = [];

    ['dragenter', 'dragover'].forEach(evt =>
      dropZone.addEventListener(evt, e => { e.preventDefault(); dropZone.classList.add('drop-zone--active'); })
    );
    ['dragleave', 'drop'].forEach(evt =>
      dropZone.addEventListener(evt, e => { e.preventDefault(); dropZone.classList.remove('drop-zone--active'); })
    );
    dropZone.addEventListener('drop', e => handleFiles([...e.dataTransfer.files]));
    dropZone.addEventListener('click', e => { if (!e.target.closest('label')) fileInput.click(); });
    dropZone.addEventListener('keydown', e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); fileInput.click(); } });
    fileInput.addEventListener('change', () => handleFiles([...fileInput.files]));

    function handleFiles(incoming) {
      const imgs = incoming.filter(f => f.type.startsWith('image/'));
      if (!imgs.length) { showError('please select at least one image file.'); return; }
      clearError();
      imgs.forEach(f => { if (!selectedFiles.find(x => x.name === f.name && x.size === f.size)) selectedFiles.push(f); });
      updateFileUI();
    }

    function removeFile(i) { selectedFiles.splice(i, 1); updateFileUI(); }

    function updateFileUI() {
      const n = selectedFiles.length;
      fileBadge.classList.toggle('hidden', n === 0);
      fileCount.textContent = n;
      fileListEl.innerHTML = '';
      selectedFiles.forEach((f, i) => {
        const li = document.createElement('li');
        li.className = 'file-list__item';
        li.innerHTML = `<span class="file-list__icon">ðŸ–¼</span><span class="file-list__name">${esc(f.name)}</span><span class="file-list__size">${fmt(f.size)}</span><button class="remove-btn" data-index="${i}" aria-label="Remove">Ã—</button>`;
        fileListEl.appendChild(li);
      });
      fileListEl.querySelectorAll('.remove-btn').forEach(b =>
        b.addEventListener('click', () => removeFile(Number(b.dataset.index)))
      );
      processBtn.disabled = n === 0;
      btnText.textContent = n > 0 ? `process ${n} photo${n > 1 ? 's' : ''}` : 'select photos to begin';
    }

    processBtn.addEventListener('click', async () => {
      if (!selectedFiles.length) return;
      setLoading(true); clearError(); showSection('progress');
      const fd = new FormData();
      selectedFiles.forEach(f => fd.append('images', f));
      fd.append('layout', document.querySelector('input[name="layout"]:checked').value);
      try {
        const res = await fetch('/upload', { method: 'POST', body: fd });
        if (!res.ok) { const d = await res.json().catch(() => ({})); throw new Error(d.error || `server error ${res.status}`); }
        const blob = await res.blob();
        downloadLink.href = URL.createObjectURL(blob);

        // Use JSZip to offer individual files
        const separateFilesWrap = document.getElementById('separate-files-wrap');
        const separateFilesList = document.getElementById('separate-files-list');
        separateFilesList.innerHTML = '';
        separateFilesWrap.classList.add('hidden');

        try {
          const zip = await JSZip.loadAsync(blob);
          const fileNames = Object.keys(zip.files);
          if (fileNames.length > 0) {
            separateFilesWrap.classList.remove('hidden');
            fileNames.forEach(relativePath => {
              const file = zip.files[relativePath];
              if (!file.dir) {
                file.async("blob").then(function (fileBlob) {
                  const url = URL.createObjectURL(fileBlob);
                  const a = document.createElement("a");
                  a.href = url;
                  a.download = relativePath;
                  a.textContent = relativePath;
                  a.className = "btn btn--secondary";
                  a.style.padding = "10px";
                  a.style.fontSize = "0.85rem";
                  separateFilesList.appendChild(a);
                });
              }
            });
          }
        } catch (zipErr) {
          console.error("Could not parse ZIP to generate separate files", zipErr);
        }

        showSection('success');
      } catch (err) { showSection('none'); showError(err.message || 'an unexpected error occurred.'); }
      finally { setLoading(false); }
    });

    resetBtn.addEventListener('click', () => {
      selectedFiles = []; fileInput.value = '';
      updateFileUI(); showSection('none'); clearError();
    });

    function setLoading(on) {
      processBtn.disabled = on;
      btnSpinner.classList.toggle('hidden', !on);
      btnText.textContent = on ? 'processing\u2026' : `process ${selectedFiles.length} photo${selectedFiles.length > 1 ? 's' : ''}`;
    }
    function showSection(s) {
      resultSection.classList.toggle('hidden', s === 'none');
      progressState.classList.toggle('hidden', s !== 'progress');
      successState.classList.toggle('hidden', s !== 'success');
    }
    function showError(m) { errorMsg.textContent = m; errorMsg.classList.remove('hidden'); }
    function clearError() { errorMsg.classList.add('hidden'); errorMsg.textContent = ''; }
    function fmt(b) { if (b < 1024) return b + ' B'; if (b < 1048576) return (b / 1024).toFixed(1) + ' KB'; return (b / 1048576).toFixed(1) + ' MB'; }
    function esc(s) { return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
  </script>
</body>

</html>